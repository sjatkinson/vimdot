#!/usr/bin/env ruby

require 'pathname'
require 'fileutils'

include FileUtils

BUNDLE_HOME = Pathname.new( ENV['HOME'] ) + '.vim' + 'bundle'
AUTOLOAD_HOME = Pathname.new( ENV['HOME'] ) + '.vim' + 'autoload'


def install_dir(basedir, bundle)
   basedir + bundle.to_s
end

def git(url, location)
   if File.exists?(location + ".git")
      puts "try to update #{url}"
      cd location do
         system "git pull"
      end
   else
      system "git clone #{url} #{location}"
  end
end

def download_tar(url, target_path)
   mkdir_p target_path
   system "cd #{target_path} && curl -s '#{url}' | tar zx -"
end

def download(url, target_path)
   mkdir_p target_path
   filename = File.basename(url)
   system "cd #{target_path} && curl -s #{url} >> #{Pathname.new(target_path) + filename}"
end

puts "install pathogen"

{
   :pathogen => "https://raw.github.com/tpope/vim-pathogen/HEAD/autoload/pathogen.vim"
}.each do |name, url|
   puts "*" * 72
   puts "*** download #{name} to #{AUTOLOAD_HOME}"
   puts # blank line
   download url, AUTOLOAD_HOME
end


puts "Update git repositories"

{ 
   :css_color => "git://github.com/ap/vim-css-color.git",
   :nerdcommenter => "git://github.com/scrooloose/nerdcommenter.git",
   :nerdtree => "git://github.com/scrooloose/nerdtree.git",
   :rails => "git://github.com/tpope/vim-rails.git",
   :surround => "git://github.com/tpope/vim-surround.git",
   :tabular => "git://github.com/godlygeek/tabular",
   # syntax highlighting
   :syntax_git => "git://github.com/tpope/vim-git.git",
   :syntax_markdown => "git://github.com/ujihisa/vim-markdown.git",
   :syntax_rdoc => "git://github.com/depuracao/vim-rdoc.git",

   # color schemes
   :colors_solarized => "git://github.com/altercation/vim-colors-solarized.git"
}.each do |name, url|
   puts "*" * 72
   puts "*** checking #{name}"
   puts # blank line
   git url, install_dir(BUNDLE_HOME, name)
end

puts "download and install tarballs"

{
   :bufexplorer => "http://www.vim.org/scripts/download_script.php?src_id=12904",
   :taglist => "http://www.vim.org/scripts/download_script.php?src_id=7701"
}.each do |name, url|
   puts "*" * 72
   puts "*** downloading #{name}"
   puts # blank line
   download_tar url, install_dir(BUNDLE_HOME, name)
end
